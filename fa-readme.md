# 🍬 CandyHole - راه‌اندازی تونل Paqet

یک اسکریپت کاربرپسند برای راه‌اندازی تونل‌های Paqet بین ایران و سرورهای خارجی، که به دور زدن سانسور اینترنت کمک می‌کند.

## شروع سریع

### گزینه ۱: دانلود مستقیم و اجرای اسکریپت

اسکریپت را مستقیماً از GitHub دانلود و اجرا کنید:

```bash
# دانلود اسکریپت
wget https://raw.githubusercontent.com/AmiRCandy/CandyHole/master/CandyHole.sh


# قابل اجرا کردن (سیستم‌های Linux/Unix)
chmod +x CandyHole.sh

# اجرا به عنوان root
sudo ./CandyHole.sh
```

### گزینه ۲: اجرای مستقیم با curl

یا بدون دانلود مستقیم اجرا کنید:

```bash
sudo curl -sSL https://raw.githubusercontent.com/AmiRCandy/CandyHole/master/CandyHole.sh | sudo bash
```


## ویژگی‌ها

- 🎨 **رابط رنگی**: خروجی رنگی زیبا و خوانا
- ✅ **اعتبارسنجی ورودی**: بررسی صحت آدرس‌های IP، پورت‌ها و ورودی‌های کاربر
- 🔧 **پیکربندی خودکار**: تولید فایل‌های YAML مناسب برای کلاینت و سرور
- 🛡️ **راه‌اندازی فایروال**: پیکربندی خودکار iptables و UFW
- 🔄 **سرویس سیستم**: ایجاد و مدیریت سرویس systemd برای Paqet
- 📝 **مدیریت خطا**: بررسی خطای جامع و بازیابی
- 📊 **نمایشگر پیشرفت**: نمایش پیشرفت در حین راه‌اندازی

## پیش‌نیازها

- سیستم Linux مبتنی بر Ubuntu/Debian
- دسترسی root (اجرای با `sudo`)
- اتصال اینترنت

## نحوه استفاده

اسکریپت را دانلود و اجرا کنید:

```bash
wget https://raw.githubusercontent.com/AmiRCandy/CandyHole/master/CandyHole.sh
chmod +x CandyHole.sh
sudo ./CandyHole.sh
```

یا مستقیم اجرا کنید:

```bash
sudo curl -sSL https://raw.githubusercontent.com/AmiRCandy/CandyHole/master/CandyHole.sh | sudo bash
```

### راه‌اندازی سرور (سرور خارجی)

۱. گزینه "1) Server (Foreign server outside Iran)" را انتخاب کنید
۲. پورت مورد نظر خود را وارد کنید (پیش‌فرض: 8080)
۳. اسکریپت به صورت خودکار:
   - Paqet و وابستگی‌ها را نصب می‌کند
   - یک کلید مخفی تولید می‌کند
   - تنظیمات شبکه را پیکربندی می‌کند
   - قوانین فایروال را تنظیم می‌کند
   - سرویس systemd ایجاد می‌کند
   - تونل را راه‌اندازی می‌کند

**اطلاعات تولید شده را ذخیره کنید:**
- IP سرور
- پورت سرور
- کلید مخفی

### راه‌اندازی کلاینت (سرور ایران)

۱. گزینه "2) Client (Iran server)" را انتخاب کنید
۲. آدرس IP سرور خارجی را وارد کنید
۳. پورت سرور را وارد کنید
۴. کلید مخفی از راه‌اندازی سرور را وارد کنید
۵. اسکریپت به صورت خودکار همه چیز را پیکربندی می‌کند

### حذف نصب

برای حذف کامل Paqet و همه اجزای آن:

۱. گزینه "3) Uninstall Paqet" را انتخاب کنید
۲. اسکریپت به صورت خودکار:
   - سرویس Paqet را متوقف و حذف می‌کند
   - فایل‌های پیکربندی را حذف می‌کند
   - باینری Paqet را حذف می‌کند
   - قوانین فایروال را پاکسازی می‌کند
   - بسته‌های سیستم نصب شده را حذف می‌کند (اختیاری)

## عملکرد

### برای سرور:
- نرم‌افزار تونلینگ Paqet را نصب می‌کند
- کلید مخفی منحصر به فرد تولید می‌کند
- پیکربندی سرور با تنظیمات شبکه شناسایی شده ایجاد می‌کند
- قوانین فایروال را تنظیم می‌کند
- سرویس systemd برای شروع خودکار ایجاد می‌کند
- پروکسی SOCKS5 در `127.0.0.1:1404` ارائه می‌دهد

### برای کلاینت:
- نرم‌افزار تونلینگ Paqet را نصب می‌کند
- پیکربندی کلاینت متصل به سرور شما ایجاد می‌کند
- قوانین فایروال را تنظیم می‌کند
- سرویس systemd برای شروع خودکار ایجاد می‌کند
- تونل برای دور زدن سانسور ارائه می‌دهد

## فایل‌های پیکربندی

- **سرور**: `/etc/paqet/server.yaml`
- **کلاینت**: `/etc/paqet/client.yaml`
- **سرویس**: `/etc/systemd/system/paqet.service`

## دستورات مفید

```bash
# بررسی وضعیت سرویس
sudo systemctl status paqet

# مشاهده لاگ‌های لحظه‌ای
sudo journalctl -u paqet -f

# راه‌اندازی مجدد سرویس
sudo systemctl restart paqet

# متوقف کردن سرویس
sudo systemctl stop paqet

# ویرایش پیکربندی
sudo nano /etc/paqet/server.yaml  # or client.yaml
```

## عیب‌یابی

۱. **سرویس راه‌اندازی نمی‌شود**: لاگ‌ها را با `sudo journalctl -u paqet -f` بررسی کنید
۲. **مشکلات اتصال**: تنظیمات فایروال و دسترسی پورت را بررسی کنید
۳. **تشخیص شبکه شکست خورد**: خروجی `ip route` و پیکربندی شبکه را بررسی کنید
۴. **مشکلات دسترسی**: مطمئن شوید به عنوان root اجرا می‌کنید

## یادداشت‌های امنیتی

- اسکریپت یک کلید مخفی تصادفی برای احراز هویت تولید می‌کند
- قوانین فایروال برای اجازه ترافیک ضروری پیکربندی می‌شوند
- پروکسی SOCKS5 از اعتبارنامه‌های پیش‌فرض استفاده می‌کند (در صورت نیاز در پیکربندی تغییر دهید)

## پیکربندی پیشرفته

پس از راه‌اندازی، می‌توانید فایل‌های پیکربندی YAML را ویرایش کنید تا:
- تنظیمات KCP را برای عملکرد بهتر تغییر دهید
- سطح لاگ‌گیری را تغییر دهید
- تنظیمات رابط شبکه را تنظیم کنید
- کاربران SOCKS5 اضافی پیکربندی کنید

## مخزن

- **مخزن CandyHole**: [https://github.com/AmiRCandy/CandyHole](https://github.com/AmiRCandy/CandyHole)
- **URL مستقیم اسکریپت**: [https://raw.githubusercontent.com/AmiRCandy/CandyHole/master/CandyHole.sh](https://raw.githubusercontent.com/AmiRCandy/CandyHole/master/CandyHole.sh)

## پشتیبانی

- **مشکلات CandyHole**: یک issue در [مخزن CandyHole](https://github.com/AmiRCandy/CandyHole) ایجاد کنید
- **مشکلات Paqet**: [مخزن رسمی Paqet](https://github.com/hanselime/paqet) را بررسی کنید

# سپاسگزاری از
- [**LlamaStudioCommunity**](https://t.me/LlamaStudioCommunity)

---

**تونلینگ خوشحال! 🌐**
